{% extends "base.html" %}
{% load static %}

{% block title %}Upload avatar thí sinh{% endblock %}

{% block content %}
<div class="mx-auto max-w-3xl px-4">
  <div class="glass rounded-2xl border border-white/30 shadow-lg">
    <div class="p-6 md:p-8">
      <h1 class="text-2xl font-semibold">Upload avatar thí sinh</h1>
      <p class="mt-2 text-white/80 text-sm">
        Chọn nhiều file ảnh (<span class="font-medium">.jpg, .jpeg, .png</span>).
      </p>

      <form class="mt-6 space-y-5" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div>
          <label class="block text-sm mb-2">Ảnh thí sinh</label>
          <input id="images-input" type="file" name="images" multiple
                 accept=".jpg,.jpeg,.png,image/*" class="sr-only">

          <label for="images-input"
                 class="flex flex-col items-center justify-center gap-2 text-center cursor-pointer
                        rounded-2xl border-2 border-dashed border-white/50 bg-white/10 p-6
                        hover:bg-white/20 transition">
            <div class="text-sm">
              <span class="font-medium">Kéo & thả</span> hoặc
              <span class="underline">chọn nhiều ảnh</span>
            </div>
            <div id="images-name" class="text-xs text-white/80" style="font-size: medium;"></div>
          </label>
        </div>

        <div class="pt-2">
          <button type="submit"
                  class="inline-flex items-center rounded-xl bg-sky-500 hover:bg-sky-600 active:bg-sky-700
                         px-4 py-2 font-medium text-white">
            Upload & cập nhật
          </button>
        </div>
      </form>

      {% if messages %}
      <ul class="mt-5 space-y-2">
        {% for message in messages %}
          {% if "success" in message.tags %}
            <li class="rounded-xl bg-green-500/20 border border-green-400/40 px-4 py-2 text-green-100">
              {{ message }}
            </li>
          {% elif "error" in message.tags or "warning" in message.tags %}
            <li class="rounded-xl bg-red-500/20 border border-red-400/40 px-4 py-2 text-red-100">
              {{ message }}
            </li>
          {% else %}
            <li class="rounded-xl bg-white/10 border border-white/20 px-4 py-2">
              {{ message }}
            </li>
          {% endif %}
        {% endfor %}
      </ul>
      {% endif %}
    </div>
  </div>

  <div class="mt-6 glass rounded-2xl border border-white/30 p-5"
       style="backdrop-filter: blur(20px);-webkit-backdrop-filter: blur(20px);">
    <h2 class="font-semibold">Ghi chú</h2>
    <ul class="mt-2 list-disc pl-5 text-white/80 text-sm space-y-1">
      <li>Tên file phải sử dụng mã nhân viên, ví dụ: <code>00353288.jpg</code>, <code>00363588.png</code>.</li>
      <li>Nếu mã không tồn tại trong bảng thí sinh, hệ thống sẽ báo ở phần cảnh báo.</li>
      <li>Nếu upload lại cùng mã, ảnh cũ sẽ được thay bằng ảnh mới.</li>
    </ul>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const input   = document.getElementById('images-input');
  const nameBox = document.getElementById('images-name');

  if (!input || !nameBox) return;

  function showNames(files) {
    if (!files || !files.length) {
      nameBox.textContent = '';
      return;
    }
    if (files.length === 1) {
      nameBox.textContent = files[0].name;
    } else {
      nameBox.textContent = files.length + ' ảnh đã chọn';
    }
  }

  input.addEventListener('change', () => showNames(input.files));
});
</script>
{% endblock %}
